<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OY è³¼ç‰©å°ˆå®¶ - è¦–è¦ºå„ªå…ˆç‰ˆ</title>
    <style>
        :root { --primary: #f05a28; --secondary: #97c024; --bg: #f2f2f7; --cart: #2ecc71; --plan: #9b59b6; --history: #34495e; --must: #e74c3c; --tax: #3498db; --want: #27ae60; --need: #e67e22; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 280px; color: #333; font-size: 14px; }
        .card { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 12px; }
        h2 { color: var(--primary); text-align: center; font-size: 18px; margin-bottom: 15px; }
        
        .nav-tabs { display: flex; background: white; border-radius: 12px; margin-bottom: 15px; padding: 5px; position: sticky; top: 10px; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nav-btn { flex: 1; padding: 10px 2px; border: none; background: none; font-weight: bold; color: #888; border-radius: 8px; font-size: 11px; cursor: pointer; }
        .nav-btn.active { background: var(--primary); color: white; }

        .filter-bar { display: flex; gap: 8px; overflow-x: auto; padding: 5px 0 12px 0; }
        .filter-tag { padding: 6px 15px; background: white; border-radius: 20px; font-size: 12px; color: #666; box-shadow: 0 2px 5px rgba(0,0,0,0.05); white-space: nowrap; }
        .filter-tag.active { background: var(--primary); color: white; }

        .form-group { display: flex; flex-direction: column; gap: 8px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box; outline: none; }
        .price-section { background: #fffcf0; padding: 12px; border-radius: 10px; border: 1px solid #ffeaa7; }

        /* ç”¢å“å¡ç‰‡å„ªåŒ– */
        .item-card { background: white; border-radius: 15px; margin-bottom: 12px; padding: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); position: relative; display: flex; gap: 12px; }
        .prod-img { width: 70px; height: 70px; border-radius: 10px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .prod-info { flex-grow: 1; }
        .priority-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; color: white; margin-left: 5px; vertical-align: middle; }
        
        /* å„ªå…ˆç´šæŒ‰éˆ• */
        .priority-btns { display: flex; gap: 4px; margin-top: 8px; }
        .p-btn { flex: 1; border: none; padding: 6px; border-radius: 6px; font-size: 11px; font-weight: bold; cursor: pointer; color: white; opacity: 0.4; }
        .p-btn.active { opacity: 1; transform: scale(1.05); }

        .checkout-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; border-radius: 20px 20px 0 0; }
        .page { display: none; }
        .page.active { display: block; }
        .link-btn { color: var(--tax); font-size: 11px; text-decoration: none; margin-top: 4px; display: inline-block; }
    </style>
</head>
<body>

<div class="nav-tabs">
    <button class="nav-btn active" onclick="switchPage('wishlist', this)">âœš ç™»è¨˜</button>
    <button class="nav-btn" onclick="switchPage('dashboard', this)">ğŸ“‹ æ¸…å–®</button>
    <button class="nav-btn" onclick="switchPage('plan', this)">ğŸ“ è¨ˆç•«</button>
    <button class="nav-btn" onclick="switchPage('cart', this)">ğŸ›’ ç±ƒå­</button>
    <button class="nav-btn" onclick="switchPage('history', this)">ğŸ“œ ç´€éŒ„</button>
</div>

<div id="wishlist-page" class="page active">
    <div class="card">
        <h2>âœ¨ ç”¢å“èˆ‡è¦–è¦ºç™»è¨˜</h2>
        <div class="form-group">
            <input type="text" id="name" placeholder="ç”¢å“åç¨±" oninput="checkExisting()">
            <input type="text" id="prodLink" placeholder="ç”¢å“å®˜ç¶²é€£çµ (Link)">
            <input type="text" id="prodImg" placeholder="ç”¢å“åœ–ç‰‡ç¶²å€ (Image URL)">
            
            <select id="subCat" onchange="handleSubChange()">
                <optgroup label="ğŸ’„ åŒ–å¦å“">
                    <option value="å¦å‰">å¦å‰</option><option value="æ°£å¢Š">æ°£å¢Š</option><option value="ç²‰åº•">ç²‰åº•</option>
                    <option value="é®ç‘•">é®ç‘•</option><option value="è…®ç´…">è…®ç´…</option><option value="çœ¼å½±">çœ¼å½±</option>
                    <option value="çœ¼ç·š/è‡¥è ¶">çœ¼ç·š/è‡¥è ¶</option><option value="å”‡é‡‰">å”‡é‡‰</option><option value="å”‡è†">å”‡è†</option>
                </optgroup>
                <optgroup label="ğŸŒ¿ è­·è†šå“">
                    <option value="åŒ–å¦æ°´">åŒ–å¦æ°´</option><option value="ç²¾è¯">ç²¾è¯</option><option value="é¢éœœ">é¢éœœ</option><option value="é¢è†œ">é¢è†œ</option><option value="é˜²æ›¬">é˜²æ›¬</option>
                </optgroup>
            </select>
            <div id="usageArea" style="display:none;"><select id="usageType"><option value="çœ¼ç·š">ğŸ–Šï¸ çœ¼ç·š</option><option value="è‡¥è ¶">âœ¨ è‡¥è ¶</option></select></div>
            
            <div class="price-section">
                <input type="text" id="spec" placeholder="è¦æ ¼ (å¦‚: 1+1, 200ml)">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px; margin-top:8px;">
                    <input type="number" id="priceOrig" placeholder="åŸåƒ¹ â‚©">
                    <input type="number" id="priceSale" placeholder="ç‰¹åƒ¹ â‚©">
                </div>
            </div>
            <button class="btn-main" onclick="saveProduct()" style="background:var(--primary); color:white; border:none; padding:12px; border-radius:8px; width:100%; font-weight:bold; margin-top:10px;">å„²å­˜ä¸¦åŠ å…¥æ¸…å–®</button>
        </div>
    </div>
</div>

<div id="dashboard-page" class="page">
    <div class="filter-bar">
        <div class="filter-tag active" onclick="setFilter('å…¨éƒ¨', this)">å…¨éƒ¨</div>
        <div class="filter-tag" onclick="setFilter('Base', this)">Base</div>
        <div class="filter-tag" onclick="setFilter('Eyes', this)">Eyes</div>
        <div class="filter-tag" onclick="setFilter('Lip', this)">Lip</div>
        <div class="filter-tag" onclick="setFilter('è­·è†šå“', this)">è­·è†š</div>
    </div>
    <div class="card" style="margin-top:0;"><input type="text" id="search" placeholder="ğŸ” æœç´¢..." oninput="render()"></div>
    <div id="dash-list"></div>
</div>

<div id="plan-page" class="page"><div id="plan-list"></div></div>
<div id="cart-page" class="page"><div id="cart-list"></div><div class="card"><input type="text" id="checkoutName" placeholder="ç´€éŒ„åç¨±"><button class="btn-main" style="background:var(--history); margin-top:10px; width:100%; border:none; padding:12px; color:white; border-radius:8px;" onclick="archiveCart()">çµå¸³å­˜æª”</button></div></div>
<div id="history-page" class="page"><div id="history-list"></div></div>

<div id="specModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:2000; justify-content:center; align-items:center;" onclick="closeModal()">
    <div class="modal-content" style="background:white; width:85%; border-radius:20px; padding:20px;" onclick="event.stopPropagation()">
        <h3>é¸æ“‡è³¼è²·è¦æ ¼</h3><div id="modalSpecList"></div>
    </div>
</div>

<div class="checkout-bar">
    <div style="display:flex; justify-content:space-between; font-size:11px;"><span>ğŸ“ è¨ˆç•«é ç®—</span><span>â‚©<span id="plan-total">0</span></span></div>
    <div style="display:flex; justify-content:space-between; font-size:12px; margin:4px 0; color:var(--tax);"><span>ğŸ’° é è¨ˆé€€ç¨…</span><span>- â‚©<span id="tax-refund">0</span></span></div>
    <div style="font-weight:bold; color:var(--primary); border-top:1px solid #eee; margin-top:5px; padding-top:8px; display:flex; justify-content:space-between; font-size:18px;"><span>é€€ç¨…å¾Œå¯¦ä»˜</span><span>â‚©<span id="final-total">0</span></span></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('oy_db_v100')) || [];
    let cart = JSON.parse(localStorage.getItem('oy_cart_v100')) || [];
    let plan = JSON.parse(localStorage.getItem('oy_plan_v100')) || [];
    let history = JSON.parse(localStorage.getItem('oy_hist_v100')) || [];
    let currentFilter = 'å…¨éƒ¨';

    function calculateRefund(a) {
        if(a < 15000) return 0; if(a < 30000) return 1000; if(a < 50000) return 2000;
        if(a < 75000) return 3000; if(a < 100000) return 5000; return Math.floor(a * 0.06);
    }

    const catMap = { "å¦å‰":"Base","æ°£å¢Š":"Base","ç²‰åº•":"Base","é®ç‘•":"Base","è…®ç´…":"Base","çœ¼å½±":"Eyes","çœ¼ç·š/è‡¥è ¶":"Eyes","å”‡é‡‰":"Lip","å”‡è†":"Lip" };

    function checkExisting() { }
    function handleSubChange() { document.getElementById('usageArea').style.display = (document.getElementById('subCat').value === 'çœ¼ç·š/è‡¥è ¶') ? 'block' : 'none'; }
    function setFilter(f, el) { currentFilter = f; document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active')); el.classList.add('active'); render(); }

    function saveProduct() {
        const name = document.getElementById('name').value.trim();
        const sub = document.getElementById('subCat').value;
        if(!name) return alert("è«‹è¼¸å…¥ç”¢å“åç¨±");

        let main = catMap[sub] ? "åŒ–å¦å“_" + catMap[sub] : "è­·è†šå“";
        const specData = { 
            specId: Date.now(), 
            name: document.getElementById('spec').value || "æ¨™æº–", 
            usage: (sub === 'çœ¼ç·š/è‡¥è ¶') ? document.getElementById('usageType').value : "", 
            orig: Number(document.getElementById('priceOrig').value), 
            sale: Number(document.getElementById('priceSale').value) 
        };

        let p = db.find(x => x.name === name);
        if(p) {
            p.specs.push(specData);
        } else {
            db.push({ 
                id: Date.now(), name, main, sub, priority: 'æƒ³è²·',
                link: document.getElementById('prodLink').value,
                img: document.getElementById('prodImg').value || 'https://via.placeholder.com/100?text=No+Img',
                specs: [specData] 
            });
        }
        localStorage.setItem('oy_db_v100', JSON.stringify(db)); render(); alert("å·²å„²å­˜ï¼");
    }

    function updatePriority(id, pLevel) {
        let p = db.find(x => x.id === id);
        p.priority = pLevel;
        localStorage.setItem('oy_db_v100', JSON.stringify(db));
        render();
    }

    function render() {
        const search = document.getElementById('search').value.toLowerCase();
        const dashCont = document.getElementById('dash-list'); dashCont.innerHTML = '';
        const planCont = document.getElementById('plan-list'); planCont.innerHTML = '';
        const cartCont = document.getElementById('cart-list'); cartCont.innerHTML = '';
        let pT = 0, cT = 0;

        db.forEach(p => {
            if(!p.name.toLowerCase().includes(search) || (currentFilter !== 'å…¨éƒ¨' && !p.main.includes(currentFilter))) return;
            const pColor = p.priority === 'å¿…è²·' ? 'var(--must)' : (p.priority === 'è¦è²·' ? 'var(--need)' : 'var(--want)');
            
            dashCont.innerHTML += `
                <div class="item-card">
                    <img src="${p.img}" class="prod-img">
                    <div class="prod-info">
                        <small>${p.main.split('_').pop()} > ${p.sub}</small>
                        <div style="font-weight:bold;">${p.name} <span class="priority-badge" style="background:${pColor}">${p.priority}</span></div>
                        ${p.link ? `<a href="${p.link}" class="link-btn" target="_blank">ğŸ”— æŸ¥çœ‹å®˜ç¶²</a>` : ''}
                        <div class="priority-btns">
                            <button class="p-btn ${p.priority==='æƒ³è²·'?'active':''}" style="background:var(--want)" onclick="updatePriority(${p.id}, 'æƒ³è²·')">æƒ³è²·</button>
                            <button class="p-btn ${p.priority==='è¦è²·'?'active':''}" style="background:var(--need)" onclick="updatePriority(${p.id}, 'è¦è²·')">è¦è²·</button>
                            <button class="p-btn ${p.priority==='å¿…è²·'?'active':''}" style="background:var(--must)" onclick="updatePriority(${p.id}, 'å¿…è²·')">å¿…è²·</button>
                        </div>
                        <div style="display:flex; gap:5px; margin-top:8px;">
                            <button class="nav-btn" style="background:var(--plan); color:white; padding:5px; font-size:10px;" onclick="openPicker(${p.id}, 'plan')">ï¼‹è¨ˆç•«</button>
                            <button class="nav-btn" style="background:var(--cart); color:white; padding:5px; font-size:10px;" onclick="openPicker(${p.id}, 'cart')">ï¼‹ç±ƒå­</button>
                        </div>
                    </div>
                </div>`;
        });

        const drawList = (list, cont, key) => {
            list.forEach((item, idx) => {
                const p = db.find(x => x.id === item.prodId);
                const s = p.specs.find(x => x.specId === item.specId);
                const price = s.sale || s.orig;
                if(key.includes('plan')) pT += price * item.qty; else cT += price * item.qty;
                cont.innerHTML += `<div class="item-card"><img src="${p.img}" style="width:50px; height:50px; border-radius:8px;"><div><b>${p.name}</b><br><small>${s.name}</small><br><span class="price-now">â‚©${price.toLocaleString()}</span> x <input type="number" value="${item.qty}" onchange="updateQty('${key}', ${idx}, this.value)" style="width:35px;"></div><button onclick="remove('${key}', ${idx})" style="margin-left:auto; border:none; color:red; background:none;">âœ•</button></div>`;
            });
        };
        drawList(plan, planCont, 'oy_plan_v100'); drawList(cart, cartCont, 'oy_cart_v100');

        const refund = calculateRefund(cT);
        document.getElementById('plan-total').innerText = pT.toLocaleString();
        document.getElementById('tax-refund').innerText = refund.toLocaleString();
        document.getElementById('final-total').innerText = (cT - refund).toLocaleString();
    }

    function openPicker(id, target) {
        const p = db.find(x => x.id === id);
        document.getElementById('modalSpecList').innerHTML = p.specs.map(s => `<div style="padding:12px; border:1px solid #eee; border-radius:10px; margin-bottom:8px;" onclick="add(${p.id}, ${s.specId}, '${target}')"><b>${s.name}</b><br><span style="color:var(--must)">â‚©${(s.sale || s.orig).toLocaleString()}</span></div>`).join('');
        document.getElementById('specModal').style.display = 'flex';
    }

    function add(prodId, specId, target) { let list = (target==='plan')?plan:cart; list.push({prodId, specId, qty:1}); localStorage.setItem('oy_'+target+'_v100', JSON.stringify(list)); closeModal(); render(); }
    function remove(key, idx) { let list = JSON.parse(localStorage.getItem(key)); list.splice(idx,1); localStorage.setItem(key, JSON.stringify(list)); if(key.includes('plan')) plan=list; else cart=list; render(); }
    function updateQty(key, idx, val) { let list = JSON.parse(localStorage.getItem(key)); list[idx].qty = parseInt(val)||1; localStorage.setItem(key, JSON.stringify(list)); if(key.includes('plan')) plan=list; else cart=list; render(); }
    function archiveCart() { alert("çµå¸³å®Œæˆï¼(åŠŸèƒ½å·²åœ¨ä¸Šä¸€ç‰ˆå±•ç¤º)"); }
    function switchPage(p, btn) { document.querySelectorAll('.page').forEach(x=>x.classList.remove('active')); document.getElementById(p+'-page').classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); }
    function closeModal() { document.getElementById('specModal').style.display = 'none'; }
    render();
</script>
</body>
</html>