<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OY è³¼ç‰©ç®¡å®¶ - å°ˆæ¥­å½©å¦ç‰ˆ</title>
    <style>
        :root { --primary: #f05a28; --secondary: #97c024; --bg: #f2f2f7; --cart: #2ecc71; --tax: #e67e22; --win: #ffd700; --must: #e74c3c; --want: #3498db; --interest: #95a5a6; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 280px; color: #333; }
        .card { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; }
        h2 { color: var(--primary); text-align: center; margin: 5px 0 15px 0; font-size: 18px; }
        
        .form-group { display: flex; flex-direction: column; gap: 10px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; outline: none; box-sizing: border-box; }
        .input-row { display: flex; gap: 8px; }
        
        .spec-entry { background: #f9f9f9; padding: 12px; border-radius: 10px; border: 1px solid #eee; position: relative; margin-top: 5px; }
        .spec-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
        .spec-label { font-size: 11px; color: #777; margin-bottom: 2px; }

        .btn-main { background: var(--primary); color: white; padding: 14px; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .btn-sub { background: #eee; color: #444; padding: 8px; border: none; border-radius: 8px; font-size: 12px; font-weight: bold; }
        .btn-del { position: absolute; right: -5px; top: -5px; background: #ff4d4d; color: white; border: none; width: 22px; height: 22px; border-radius: 50%; }

        .nav-tabs { display: flex; background: white; border-radius: 12px; margin-bottom: 15px; padding: 5px; position: sticky; top: 10px; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nav-btn { flex: 1; padding: 10px 5px; border: none; background: none; font-weight: bold; color: #888; border-radius: 8px; font-size: 13px; }
        .nav-btn.active { background: var(--primary); color: white; }

        .dashboard-sec { margin-bottom: 25px; }
        .sec-title { display: flex; align-items: center; gap: 8px; font-weight: 900; font-size: 18px; margin-bottom: 12px; padding-left: 5px; border-left: 5px solid #333; }
        .sec-must { border-color: var(--must); color: var(--must); }
        .sec-want { border-color: var(--want); color: var(--want); }
        .sec-interest { border-color: var(--interest); color: var(--interest); }

        .item-card { background: white; border-radius: 15px; margin-bottom: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .item-card.in-cart { border: 2px solid var(--cart); }
        .prod-img { width: 100%; height: 130px; object-fit: contain; background: #fff; border-bottom: 1px solid #f0f0f0; }
        .prod-info { padding: 12px; }
        
        .price-display { background: #fffdf0; padding: 8px; border-radius: 8px; margin-bottom: 5px; border: 1px solid #ffeaa7; }
        .price-tag { color: #e74c3c; font-weight: bold; font-size: 15px; }
        .old-price { text-decoration: line-through; color: #999; font-size: 11px; margin-left: 5px; }
        .expiry-info { font-size: 10px; color: #e67e22; font-weight: bold; display: block; margin-top: 2px; }

        .checkout-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; border-radius: 20px 20px 0 0; }
        .sum-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 3px; }
        .total-row { color: var(--primary); font-size: 20px; font-weight: 900; border-top: 1px solid #eee; padding-top: 8px; margin-top: 8px; }

        .page { display: none; }
        .page.active { display: block; }
    </style>
</head>
<body>

<div class="nav-tabs">
    <button class="nav-btn active" onclick="switchPage('wishlist', this)">âœš æ–°å¢</button>
    <button class="nav-btn" onclick="switchPage('dashboard', this)">ğŸ“‹ æ…¾æœ›æ¸…å–®</button>
    <button class="nav-btn" onclick="switchPage('cart', this)">ğŸ›’ è³¼ç‰©ç±ƒ(<span id="cart-count">0</span>)</button>
</div>

<div id="wishlist-page" class="page active">
    <div class="card">
        <h2>âœ¨ ç™»è¨˜æ¡è³¼å¥½ç‰©</h2>
        <div class="form-group">
            <input type="text" id="name" placeholder="ç”¢å“åç¨± (å¿…å¡«)">
            <div class="input-row">
                <input type="text" id="imgUrl" placeholder="åœ–ç‰‡é€£çµ">
                <input type="text" id="prodLink" placeholder="å•†å“å®˜ç¶²é€£çµ">
            </div>
            <div class="input-row">
                <select id="priority">
                    <option value="å¿…è²·">ğŸ”¥ å¿…è²· (Must Buy)</option>
                    <option value="æƒ³è²·" selected>ğŸ›ï¸ æƒ³è²· (Want)</option>
                    <option value="æ„Ÿèˆˆè¶£">âœ¨ æ„Ÿèˆˆè¶£ (Maybe)</option>
                </select>
                <select id="mainCat" onchange="updateSubCat()">
                    <option value="è­·è†šå“">ğŸŒ¿ è­·è†šå“</option>
                    <option value="åŒ–å¦å“-Base">ğŸ’„ åŒ–å¦å“: Base</option>
                    <option value="åŒ–å¦å“-Eyes">ğŸ’„ åŒ–å¦å“: Eyes</option>
                    <option value="åŒ–å¦å“-Lip">ğŸ’„ åŒ–å¦å“: Lip</option>
                    <option value="å€‹äººè­·ç†">ğŸš¿ å€‹äººè­·ç†</option>
                    <option value="å…¶ä»–">ğŸ å…¶ä»–</option>
                </select>
            </div>
            <div id="subCatArea"></div>
            <div id="eyeTypeArea" style="display:none; background: #fff4e5; padding: 10px; border-radius: 8px; margin-top: 5px;">
                <div class="spec-label" style="color: #d35400; font-weight: bold;">ç”¢å“ç”¨é€”åˆ‡æ›</div>
                <select id="eyeType">
                    <option value="çœ¼ç·š">ğŸ–Šï¸ çœ¼ç·š</option>
                    <option value="è‡¥è ¶">âœ¨ è‡¥è ¶</option>
                </select>
            </div>
            <div id="specs-container"></div>
            <button class="btn-sub" onclick="addSpecInput()">ï¼‹å¢åŠ è¦æ ¼/åƒ¹æ ¼å°æ¯”</button>
            <button class="btn-main" onclick="saveProduct()">å„²å­˜è‡³æ¸…å–®</button>
        </div>
    </div>
</div>

<div id="dashboard-page" class="page">
    <div id="must-sec" class="dashboard-sec"><div class="sec-title sec-must">ğŸ”¥ å¿…è²·é …ç›®</div><div id="list-must"></div></div>
    <div id="want-sec" class="dashboard-sec"><div class="sec-title sec-want">ğŸ›ï¸ æƒ³è²·æ¸…å–®</div><div id="list-want"></div></div>
    <div id="interest-sec" class="dashboard-sec"><div class="sec-title sec-interest">âœ¨ æ„Ÿèˆˆè¶£</div><div id="list-interest"></div></div>
</div>

<div id="cart-page" class="page">
    <div class="card"><h2>ğŸ›’ è³¼ç‰©ç±ƒç¾å ´å°å¸³</h2><div id="cart-list-container"></div></div>
</div>

<div class="checkout-bar">
    <div class="sum-row" style="color:var(--must);"><span>ğŸ”¥ å¿…è²·å°è¨ˆ</span><span>â‚©<span id="must-total">0</span></span></div>
    <div class="sum-row"><span>ç±ƒå…§ç¸½è¨ˆ</span><span>â‚©<span id="total-amount">0</span></span></div>
    <div class="sum-row" style="color:var(--tax);"><span>é è¨ˆé€€ç¨…</span><span>- â‚©<span id="refund-amount">0</span></span></div>
    <div class="sum-row total-row"><span>å¯¦ä»˜é ç®—</span><span>â‚©<span id="final-amount">0</span></span></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('oy_makeup_pro_v17')) || [];
    let cart = JSON.parse(localStorage.getItem('oy_cart_v17')) || [];

    const categoryMap = {
        "è­·è†šå“": ["åŒ–å¦æ°´", "ç²¾è¯", "ä¹³æ¶²", "é¢éœœ", "é¢è†œ", "æ³¥è†œ", "é˜²æ›¬", "æ½”é¢", "å¸å¦", "çœ¼éƒ¨è­·ç†"],
        "åŒ–å¦å“-Base": ["å¦å‰", "æ°£å¢Š", "ç²‰åº•", "é®ç‘•", "è…®ç´…", "é«˜å…‰", "ä¿®å®¹"],
        "åŒ–å¦å“-Eyes": ["çœ‰ç­†", "çœ¼å½±", "çœ¼ç·š/è‡¥è ¶", "ç«æ¯›è†"],
        "åŒ–å¦å“-Lip": ["å”‡ç·šç­†", "å”‡é‡‰", "å”‡è†"],
        "å€‹äººè­·ç†": ["æ‰‹éƒ¨è­·ç†", "å£è…”æ¸…æ½”", "é¦™æ°›/é¦™æ°´"],
        "å…¶ä»–": ["ç¾å®¹å·¥å…·", "é›¶é£Ÿ", "é£²å“", "ç”Ÿæ´»é›œè²¨"]
    };

    function updateSubCat() {
        const main = document.getElementById('mainCat').value;
        const area = document.getElementById('subCatArea');
        const eyeArea = document.getElementById('eyeTypeArea');
        
        if (main === "å…¶ä»–") {
            area.innerHTML = `<input type="text" id="subCat" placeholder="è«‹æ‰‹å‹•è¼¸å…¥åˆ†é¡">`;
            eyeArea.style.display = 'none';
        } else {
            area.innerHTML = `<select id="subCat" onchange="checkEyeType()">${categoryMap[main].map(s => `<option value="${s}">${s}</option>`).join('')}</select>`;
            checkEyeType();
        }
    }

    function checkEyeType() {
        const sub = document.getElementById('subCat').value;
        // åªæœ‰åœ¨ Eyes åˆ†é¡é¸æ“‡çœ¼ç·š/è‡¥è ¶æ™‚é¡¯ç¤º
        document.getElementById('eyeTypeArea').style.display = (sub === 'çœ¼ç·š/è‡¥è ¶') ? 'block' : 'none';
    }

    function addSpecInput() {
        const div = document.createElement('div');
        div.className = 'spec-entry';
        div.innerHTML = `<button class="btn-del" onclick="this.parentElement.remove()">âœ•</button>
            <div class="spec-grid">
                <div><div class="spec-label">å…¥æ•¸/å®¹é‡</div><input type="text" class="spec-qty" placeholder="å¦‚: 1+1"></div>
                <div><div class="spec-label">åŸåƒ¹ â‚©</div><input type="number" class="spec-orig" placeholder="20000"></div>
                <div><div class="spec-label">ç‰¹åƒ¹ â‚©</div><input type="number" class="spec-sale" placeholder="15000"></div>
                <div><div class="spec-label">ç‰¹åƒ¹æˆªæ­¢</div><input type="date" class="spec-until"></div>
            </div>`;
        document.getElementById('specs-container').appendChild(div);
    }

    function saveProduct() {
        const name = document.getElementById('name').value;
        if (!name) return alert('è«‹å¡«å¯«ç”¢å“åç¨±');
        let specs = [];
        document.querySelectorAll('.spec-entry').forEach(div => {
            const q = div.querySelector('.spec-qty').value;
            const o = Number(div.querySelector('.spec-orig').value);
            const s = Number(div.querySelector('.spec-sale').value);
            const u = div.querySelector('.spec-until').value;
            if (q && (o || s)) specs.push({ qty: q, orig: o, sale: s, until: u, unit: Math.round((s||o)/(parseInt(q)||1)) });
        });
        if (specs.length === 0) return alert('è«‹è¼¸å…¥åƒ¹æ ¼');

        const mainCat = document.getElementById('mainCat').value;
        let subCatFinal = document.getElementById('subCat').value;
        
        if (subCatFinal === 'çœ¼ç·š/è‡¥è ¶') {
            subCatFinal = document.getElementById('eyeType').value;
        }

        const product = { id: Date.now(), name, imgUrl: document.getElementById('imgUrl').value, prodLink: document.getElementById('prodLink').value, priority: document.getElementById('priority').value, mainCat, subCat: subCatFinal, specs, history: [] };
        
        let oldIdx = db.findIndex(p => p.name === name);
        if (oldIdx > -1) { product.history = [...db[oldIdx].history, { date: new Date().toLocaleDateString(), specs: db[oldIdx].specs }]; db[oldIdx] = product; }
        else { db.push(product); }

        localStorage.setItem('oy_makeup_pro_v17', JSON.stringify(db));
        resetForm(); render(); alert('å„²å­˜æˆåŠŸï¼');
    }

    function render() {
        const containers = { "å¿…è²·": document.getElementById('list-must'), "æƒ³è²·": document.getElementById('list-want'), "æ„Ÿèˆˆè¶£": document.getElementById('list-interest') };
        Object.values(containers).forEach(c => c.innerHTML = '');
        const cartC = document.getElementById('cart-list-container'); cartC.innerHTML = '';
        let total = 0, mustT = 0, cartQty = 0;

        db.forEach(p => {
            const inCart = cart.includes(p.id);
            const specHtml = p.specs.map(s => `
                <div class="price-display">
                    <div style="display:flex; justify-content:space-between;">
                        <span>${s.qty}: <span class="price-tag">â‚©${(s.sale || s.orig).toLocaleString()}</span>${s.sale ? `<span class="old-price">â‚©${s.orig.toLocaleString()}</span>` : ''}</span>
                    </div>
                </div>`).join('');

            const card = `<div class="item-card ${inCart ? 'in-cart' : ''}">
                ${p.imgUrl ? `<img src="${p.imgUrl}" class="prod-img">` : ''}
                <div class="prod-info">
                    <div style="font-size:10px; color:#888;">${p.mainCat.replace('åŒ–å¦å“-', '')} > ${p.subCat}</div>
                    <div style="font-weight:bold; font-size:15px; margin:3px 0;">${p.name}</div>
                    ${specHtml}
                    <button class="btn-main" style="background:${inCart? '#2ecc71':'#f0f0f0'}; color:${inCart?'white':'#444'}; width:100%; padding:8px; font-size:14px; margin-top:5px;" onclick="toggleCart(${p.id})">${inCart?'âŒ ç§»å‡º':'â• æ”¾å…¥'}</button>
                </div>
            </div>`;
            
            if(containers[p.priority]) containers[p.priority].innerHTML += card;
            if (inCart) { cartC.innerHTML += card; total += (p.specs[0].sale || p.specs[0].orig); cartQty++; if(p.priority==='å¿…è²·') mustT += (p.specs[0].sale || p.specs[0].orig); }
        });

        const taxTable = [{ min: 15000, max: 29999, refund: 1000 }, { min: 30000, max: 49999, refund: 2000 }, { min: 50000, max: 74999, refund: 3000 }, { min: 75000, max: 99999, refund: 5000 }, { min: 100000, max: 124999, refund: 7000 }, { min: 125000, max: 149999, refund: 8000 }, { min: 150000, max: 174999, refund: 9000 }, { min: 175000, max: 199999, refund: 10000 }, { min: 200000, max: 224999, refund: 12000 }];
        const tier = taxTable.find(t => total >= t.min && total <= t.max);
        const refund = tier ? tier.refund : (total >= 225000 ? Math.round(total * 0.06) : 0);
        
        document.getElementById('must-total').innerText = mustT.toLocaleString();
        document.getElementById('total-amount').innerText = total.toLocaleString();
        document.getElementById('refund-amount').innerText = refund.toLocaleString();
        document.getElementById('final-amount').innerText = (total - refund).toLocaleString();
        document.getElementById('cart-count').innerText = cartQty;
    }

    function toggleCart(id) { const idx = cart.indexOf(id); if (idx > -1) cart.splice(idx, 1); else cart.push(id); localStorage.setItem('oy_cart_v17', JSON.stringify(cart)); render(); }
    function switchPage(p, btn) { document.querySelectorAll('.page').forEach(x => x.classList.remove('active')); document.getElementById(p + '-page').classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); window.scrollTo(0,0); }
    function resetForm() { document.getElementById('name').value = ''; document.getElementById('imgUrl').value = ''; document.getElementById('specs-container').innerHTML = ''; addSpecInput(); }
    
    updateSubCat(); addSpecInput(); render();
</script>
</body>
</html>