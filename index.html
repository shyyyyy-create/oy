<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Olive Young åœ–ç‰‡ç‰ˆåƒ¹æ ¼ç­†è¨˜</title>
    <style>
        :root { --primary: #f05a28; --secondary: #97c024; --bg: #f4f4f4; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 50px; }
        .card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; }
        h2 { color: var(--primary); text-align: center; font-size: 20px; margin: 10px 0; }
        
        /* è¡¨å–®æ¨£å¼ */
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; }
        input:focus { border-color: var(--primary); }
        .row { display: flex; gap: 8px; }
        .btn-main { background: var(--primary); color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; margin-top: 5px; }
        
        /* ç”¢å“æ¸…å–®æ¨£å¼ */
        .item-card { background: white; border-radius: 12px; overflow: hidden; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .prod-img { width: 100%; height: 200px; object-fit: contain; background: #fff; border-bottom: 1px solid #eee; }
        .no-img { width: 100%; height: 120px; background: #eee; display: flex; align-items: center; justify-content: center; color: #999; font-size: 14px; }
        
        .prod-content { padding: 15px; }
        .prod-title { font-size: 18px; font-weight: bold; color: #222; text-decoration: none; display: block; margin-bottom: 5px; }
        .prod-options { font-size: 13px; color: #666; background: #f9f9f9; padding: 4px 8px; border-radius: 4px; display: inline-block; margin-bottom: 10px; }
        
        .price-row { display: flex; align-items: baseline; gap: 8px; }
        .price-sale { color: #e74c3c; font-size: 22px; font-weight: 800; }
        .price-orig { color: #aaa; text-decoration: line-through; font-size: 14px; }
        
        .promo-tag { font-size: 12px; color: #f05a28; border: 1px solid #f05a28; padding: 2px 6px; border-radius: 4px; margin-top: 5px; display: inline-block; }
        
        .history-section { margin-top: 10px; border-top: 1px dashed #eee; padding-top: 10px; }
        .hist-btn { background: none; border: none; color: var(--secondary); font-size: 13px; padding: 0; cursor: pointer; }
        .hist-list { display: none; list-style: none; padding: 8px; margin: 5px 0; background: #f9f9f9; border-radius: 5px; font-size: 12px; color: #777; }

        .actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-action { flex: 1; padding: 10px; border-radius: 6px; border: none; font-size: 14px; font-weight: bold; }
        .edit { background: #e3f2fd; color: #1976d2; }
        .del { background: #ffebee; color: #c62828; }
    </style>
</head>
<body>

<div class="card">
    <h2 id="form-title">æ–°å¢æ”¶è— ğŸŒ¿</h2>
    <div class="form-group">
        <input type="hidden" id="edit-id">
        <input type="text" id="name" placeholder="ç”¢å“åç¨±">
        <input type="text" id="imgUrl" placeholder="åœ–ç‰‡ç¶²å€ (é•·æŒ‰å®˜ç¶²åœ–ç‰‡è¤‡è£½)">
        <input type="text" id="url" placeholder="ç”¢å“é€£çµç¶²å€">
        <input type="text" id="options" placeholder="é¸é … (å¦‚ï¼š02è™Ÿ, 1+1çµ„)">
        <div class="row">
            <input type="text" id="origPrice" placeholder="åŸåƒ¹">
            <input type="text" id="salePrice" placeholder="ç‰¹åƒ¹">
        </div>
        <input type="text" id="period" placeholder="ç‰¹åƒ¹æœŸé–“ (å¦‚ï¼šè‡³ 1/31)">
        <button class="btn-main" onclick="saveProduct()">å„²å­˜åˆ°æˆ‘çš„æ¸…å–®</button>
        <button id="cancel-edit" style="display:none; background:#ccc; margin-top:5px; padding:10px; border-radius:8px; border:none; color:white;" onclick="resetForm()">å–æ¶ˆä¿®æ”¹</button>
    </div>
</div>

<div id="list"></div>

<script>
    let db = JSON.parse(localStorage.getItem('oy_img_tracker')) || [];

    function saveProduct() {
        const id = document.getElementById('edit-id').value;
        const name = document.getElementById('name').value;
        const imgUrl = document.getElementById('imgUrl').value;
        const url = document.getElementById('url').value;
        const options = document.getElementById('options').value;
        const origPrice = document.getElementById('origPrice').value;
        const salePrice = document.getElementById('salePrice').value;
        const period = document.getElementById('period').value;
        const date = new Date().toLocaleDateString();

        if (!name) return alert('è«‹è¼¸å…¥ç”¢å“åç¨±');

        if (id) {
            const idx = db.findIndex(p => p.id == id);
            if (db[idx].salePrice !== salePrice) {
                db[idx].history.push({ price: db[idx].salePrice, period: db[idx].period, date: db[idx].lastUpdate });
            }
            db[idx] = { ...db[idx], name, imgUrl, url, options, origPrice, salePrice, period, lastUpdate: date };
        } else {
            db.push({ id: Date.now(), name, imgUrl, url, options, origPrice, salePrice, period, lastUpdate: date, history: [] });
        }

        localStorage.setItem('oy_img_tracker', JSON.stringify(db));
        resetForm();
        render();
    }

    function render() {
        const container = document.getElementById('list');
        container.innerHTML = '';
        db.sort((a,b) => b.id - a.id).forEach(p => {
            container.innerHTML += `
                <div class="item-card">
                    ${p.imgUrl ? `<img src="${p.imgUrl}" class="prod-img" onerror="this.src='https://via.placeholder.com/200?text=No+Image'">` : `<div class="no-img">å°šç„¡åœ–ç‰‡</div>`}
                    <div class="prod-content">
                        <a href="${p.url || '#'}" target="_blank" class="prod-title">${p.name}</a>
                        <div class="prod-options">${p.options || 'é è¨­é¸é …'}</div>
                        <div class="price-row">
                            <span class="price-sale">â‚©${p.salePrice}</span>
                            <span class="price-orig">â‚©${p.origPrice}</span>
                        </div>
                        ${p.period ? `<div class="promo-tag">æ´»å‹•ï¼š${p.period}</div>` : ''}
                        
                        <div class="history-section">
                            <button class="hist-btn" onclick="toggleHist(${p.id})">ğŸ•’ æŸ¥çœ‹åƒ¹æ ¼æ­·å² (${p.history.length})</button>
                            <ul class="hist-list" id="h-${p.id}">
                                ${p.history.map(h => `<li>${h.date}: â‚©${h.price} (${h.period})</li>`).reverse().join('')}
                            </ul>
                        </div>

                        <div class="actions">
                            <button class="btn-action edit" onclick="edit(${p.id})">ä¿®æ”¹</button>
                            <button class="btn-action del" onclick="del(${p.id})">åˆªé™¤</button>
                        </div>
                    </div>
                </div>
            `;
        });
    }

    function edit(id) {
        const p = db.find(x => x.id == id);
        document.getElementById('edit-id').value = p.id;
        document.getElementById('name').value = p.name;
        document.getElementById('imgUrl').value = p.imgUrl;
        document.getElementById('url').value = p.url;
        document.getElementById('options').value = p.options;
        document.getElementById('origPrice').value = p.origPrice;
        document.getElementById('salePrice').value = p.salePrice;
        document.getElementById('period').value = p.period;
        document.getElementById('form-title').innerText = "ç·¨è¼¯è³‡æ–™ âœï¸";
        document.getElementById('cancel-edit').style.display = "block";
        window.scrollTo(0,0);
    }

    function del(id) { if(confirm('è¦åˆªé™¤å—ï¼Ÿ')) { db = db.filter(x => x.id !== id); localStorage.setItem('oy_img_tracker', JSON.stringify(db)); render(); } }
    function toggleHist(id) { const el = document.getElementById('h-'+id); el.style.display = el.style.display === 'block' ? 'none' : 'block'; }
    function resetForm() { 
        document.getElementById('edit-id').value = '';
        document.querySelectorAll('input').forEach(i => i.value = ''); 
        document.getElementById('form-title').innerText = "æ–°å¢æ”¶è— ğŸŒ¿";
        document.getElementById('cancel-edit').style.display = "none";
    }
    render();
</script>

</body>
</html>
