<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OY è³¼ç‰©ç®¡å®¶ - æ™ºèƒ½æœç´¢ç‰ˆ</title>
    <style>
        :root { --primary: #f05a28; --secondary: #97c024; --bg: #f2f2f7; --cart: #2ecc71; --tax: #e67e22; --win: #ffd700; --must: #e74c3c; --want: #3498db; --interest: #95a5a6; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 280px; color: #333; }
        .card { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; }
        h2 { color: var(--primary); text-align: center; margin: 5px 0 15px 0; font-size: 18px; }
        
        /* è¡¨å–®æ§ä»¶ */
        .form-group { display: flex; flex-direction: column; gap: 10px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; outline: none; box-sizing: border-box; }
        .input-row { display: flex; gap: 8px; }
        
        /* æœç´¢èˆ‡ç¯©é¸å€ */
        .search-box { margin-bottom: 15px; display: flex; flex-direction: column; gap: 8px; }
        .filter-tags { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 5px; white-space: nowrap; }
        .filter-tag { padding: 6px 12px; background: white; border-radius: 20px; font-size: 12px; border: 1px solid #ddd; cursor: pointer; }
        .filter-tag.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* è¦æ ¼å°å¡ç‰‡ */
        .spec-entry { background: #f9f9f9; padding: 12px; border-radius: 10px; border: 1px solid #eee; position: relative; margin-top: 5px; }
        .spec-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
        .spec-label { font-size: 11px; color: #777; margin-bottom: 2px; }

        .btn-main { background: var(--primary); color: white; padding: 14px; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .btn-sub { background: #eee; color: #444; padding: 8px; border: none; border-radius: 8px; font-size: 12px; font-weight: bold; }
        .btn-del { position: absolute; right: -5px; top: -5px; background: #ff4d4d; color: white; border: none; width: 22px; height: 22px; border-radius: 50%; }

        /* å°è¦½ */
        .nav-tabs { display: flex; background: white; border-radius: 12px; margin-bottom: 15px; padding: 5px; position: sticky; top: 10px; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nav-btn { flex: 1; padding: 10px 5px; border: none; background: none; font-weight: bold; color: #888; border-radius: 8px; font-size: 13px; }
        .nav-btn.active { background: var(--primary); color: white; }

        .dashboard-sec { margin-bottom: 25px; }
        .sec-title { display: flex; align-items: center; gap: 8px; font-weight: 900; font-size: 18px; margin-bottom: 12px; padding-left: 5px; border-left: 5px solid #333; }
        .sec-must { border-color: var(--must); color: var(--must); }
        .sec-want { border-color: var(--want); color: var(--want); }
        .sec-interest { border-color: var(--interest); color: var(--interest); }

        .item-card { background: white; border-radius: 15px; margin-bottom: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .item-card.in-cart { border: 2px solid var(--cart); }
        .prod-img { width: 100%; height: 130px; object-fit: contain; background: #fff; border-bottom: 1px solid #f0f0f0; }
        .prod-info { padding: 12px; }
        
        .price-display { background: #fffdf0; padding: 8px; border-radius: 8px; margin-bottom: 5px; border: 1px solid #ffeaa7; }
        .price-tag { color: #e74c3c; font-weight: bold; font-size: 15px; }

        .checkout-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; border-radius: 20px 20px 0 0; }
        .sum-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 3px; }
        .total-row { color: var(--primary); font-size: 20px; font-weight: 900; border-top: 1px solid #eee; padding-top: 8px; margin-top: 8px; }

        .page { display: none; }
        .page.active { display: block; }
    </style>
</head>
<body>

<div class="nav-tabs">
    <button class="nav-btn active" onclick="switchPage('wishlist', this)">âœš æ–°å¢</button>
    <button class="nav-btn" onclick="switchPage('dashboard', this)">ğŸ“‹ æ…¾æœ›æ¸…å–®</button>
    <button class="nav-btn" onclick="switchPage('cart', this)">ğŸ›’ è³¼ç‰©ç±ƒ(<span id="cart-count">0</span>)</button>
</div>

<div id="wishlist-page" class="page active">
    <div class="card">
        <h2>âœ¨ ç™»è¨˜æ¡è³¼å¥½ç‰©</h2>
        <div class="form-group">
            <input type="text" id="name" placeholder="ç”¢å“åç¨± (å¿…å¡«)">
            <div class="input-row">
                <input type="text" id="imgUrl" placeholder="åœ–ç‰‡é€£çµ">
                <input type="text" id="prodLink" placeholder="å•†å“é€£çµ">
            </div>
            <div class="input-row">
                <select id="priority">
                    <option value="å¿…è²·">ğŸ”¥ å¿…è²· (Must Buy)</option>
                    <option value="æƒ³è²·" selected>ğŸ›ï¸ æƒ³è²· (Want)</option>
                    <option value="æ„Ÿèˆˆè¶£">âœ¨ æ„Ÿèˆˆè¶£ (Maybe)</option>
                </select>
                <select id="mainCat" onchange="toggleMakeupSub()">
                    <option value="è­·è†šå“">ğŸŒ¿ è­·è†šå“</option>
                    <option value="åŒ–å¦å“">ğŸ’„ åŒ–å¦å“</option>
                    <option value="å€‹äººè­·ç†">ğŸš¿ å€‹äººè­·ç†</option>
                    <option value="å…¶ä»–">ğŸ“¦ å…¶ä»–</option>
                </select>
            </div>
            
            <div id="makeup-type-area" style="display:none;">
                <select id="makeupType" onchange="updateSubCat()">
                    <option value="">è«‹é¸æ“‡å½©å¦å€åŸŸ...</option>
                    <option value="Base">Base (åº•å¦/è‡‰éƒ¨)</option>
                    <option value="Eyes">Eyes (çœ¼å¦)</option>
                    <option value="Lip">Lip (å”‡å¦)</option>
                </select>
            </div>

            <div id="subCatArea"></div>
            
            <div id="eyeTypeArea" style="display:none; background: #fff4e5; padding: 10px; border-radius: 8px;">
                <select id="eyeType">
                    <option value="çœ¼ç·š">ğŸ–Šï¸ çœ¼ç·š</option>
                    <option value="è‡¥è ¶">âœ¨ è‡¥è ¶</option>
                </select>
            </div>

            <div id="specs-container"></div>
            <button class="btn-sub" onclick="addSpecInput()">ï¼‹å¢åŠ åƒ¹æ ¼å°æ¯”</button>
            <button class="btn-main" onclick="saveProduct()">å„²å­˜è‡³æ¸…å–®</button>
        </div>
    </div>
</div>

<div id="dashboard-page" class="page">
    <div class="card search-box">
        <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢ç”¢å“åç¨±..." oninput="render()">
        <div class="filter-tags" id="filterTags">
            <div class="filter-tag active" onclick="setFilter('å…¨éƒ¨', this)">å…¨éƒ¨</div>
            <div class="filter-tag" onclick="setFilter('è­·è†šå“', this)">ğŸŒ¿ è­·è†š</div>
            <div class="filter-tag" onclick="setFilter('Base', this)">ğŸ’„ Base</div>
            <div class="filter-tag" onclick="setFilter('Eyes', this)">ğŸ’„ Eyes</div>
            <div class="filter-tag" onclick="setFilter('Lip', this)">ğŸ’„ Lip</div>
            <div class="filter-tag" onclick="setFilter('å€‹äººè­·ç†', this)">ğŸš¿ å€‹è­·</div>
            <div class="filter-tag" onclick="setFilter('å…¶ä»–', this)">ğŸ“¦ å…¶ä»–</div>
        </div>
    </div>
    <div id="must-sec" class="dashboard-sec"><div class="sec-title sec-must">ğŸ”¥ å¿…è²·é …ç›®</div><div id="list-must"></div></div>
    <div id="want-sec" class="dashboard-sec"><div class="sec-title sec-want">ğŸ›ï¸ æƒ³è²·æ¸…å–®</div><div id="list-want"></div></div>
    <div id="interest-sec" class="dashboard-sec"><div class="sec-title sec-interest">âœ¨ æ„Ÿèˆˆè¶£</div><div id="list-interest"></div></div>
</div>

<div id="cart-page" class="page">
    <div class="card"><h2>ğŸ›’ è³¼ç‰©ç±ƒæ¸…å–®</h2><div id="cart-list-container"></div></div>
</div>

<div class="checkout-bar">
    <div class="sum-row" style="color:var(--must);"><span>ğŸ”¥ å¿…è²·å°è¨ˆ</span><span>â‚©<span id="must-total">0</span></span></div>
    <div class="sum-row"><span>ç±ƒå…§ç¸½è¨ˆ</span><span>â‚©<span id="total-amount">0</span></span></div>
    <div class="sum-row" style="color:var(--tax);"><span>é è¨ˆé€€ç¨…</span><span>- â‚©<span id="refund-amount">0</span></span></div>
    <div class="sum-row total-row"><span>å¯¦ä»˜é ç®—</span><span>â‚©<span id="final-amount">0</span></span></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('oy_smart_v18')) || [];
    let cart = JSON.parse(localStorage.getItem('oy_cart_v18')) || [];
    let currentFilter = 'å…¨éƒ¨';

    const subMap = {
        "è­·è†šå“": ["åŒ–å¦æ°´", "ç²¾è¯", "ä¹³æ¶²", "é¢éœœ", "é¢è†œ", "æ³¥è†œ", "é˜²æ›¬", "æ½”é¢", "å¸å¦", "çœ¼éƒ¨è­·ç†"],
        "Base": ["å¦å‰", "æ°£å¢Š", "ç²‰åº•", "é®ç‘•", "è…®ç´…", "é«˜å…‰", "ä¿®å®¹"],
        "Eyes": ["çœ‰ç­†", "çœ¼å½±", "çœ¼ç·š/è‡¥è ¶", "ç«æ¯›è†"],
        "Lip": ["å”‡ç·šç­†", "å”‡é‡‰", "å”‡è†"],
        "å€‹äººè­·ç†": ["æ‰‹éƒ¨è­·ç†", "å£è…”æ¸…æ½”", "é¦™æ°›/é¦™æ°´"],
        "å…¶ä»–": ["ç¾å®¹å·¥å…·", "é›¶é£Ÿ", "é£²å“", "ç”Ÿæ´»é›œè²¨"]
    };

    function toggleMakeupSub() {
        const main = document.getElementById('mainCat').value;
        const mkArea = document.getElementById('makeup-type-area');
        mkArea.style.display = (main === 'åŒ–å¦å“') ? 'block' : 'none';
        updateSubCat();
    }

    function updateSubCat() {
        const main = document.getElementById('mainCat').value;
        const area = document.getElementById('subCatArea');
        const mkType = document.getElementById('makeupType').value;
        
        let target = main;
        if (main === 'åŒ–å¦å“') {
            if (!mkType) { area.innerHTML = ''; return; }
            target = mkType;
        }

        if (main === "å…¶ä»–") {
            area.innerHTML = `<input type="text" id="subCat" placeholder="è¼¸å…¥è‡ªå®šç¾©åˆ†é¡">`;
        } else {
            area.innerHTML = `<select id="subCat" onchange="checkEyeType()">${subMap[target].map(s => `<option value="${s}">${s}</option>`).join('')}</select>`;
        }
        checkEyeType();
    }

    function checkEyeType() {
        const sub = document.getElementById('subCat')?.value;
        document.getElementById('eyeTypeArea').style.display = (sub === 'çœ¼ç·š/è‡¥è ¶') ? 'block' : 'none';
    }

    function addSpecInput() {
        const div = document.createElement('div');
        div.className = 'spec-entry';
        div.innerHTML = `<button class="btn-del" onclick="this.parentElement.remove()">âœ•</button>
            <div class="spec-grid">
                <div><div class="spec-label">è¦æ ¼</div><input type="text" class="spec-qty" placeholder="1+1"></div>
                <div><div class="spec-label">åŸåƒ¹</div><input type="number" class="spec-orig"></div>
                <div><div class="spec-label">ç‰¹åƒ¹</div><input type="number" class="spec-sale"></div>
                <div><div class="spec-label">æˆªæ­¢</div><input type="date" class="spec-until"></div>
            </div>`;
        document.getElementById('specs-container').appendChild(div);
    }

    function saveProduct() {
        const name = document.getElementById('name').value;
        if (!name) return alert('åç¨±å¿…å¡«');
        let specs = [];
        document.querySelectorAll('.spec-entry').forEach(div => {
            const q = div.querySelector('.spec-qty').value;
            const o = Number(div.querySelector('.spec-orig').value);
            const s = Number(div.querySelector('.spec-sale').value);
            if (q && (o || s)) specs.push({ qty: q, orig: o, sale: s, until: div.querySelector('.spec-until').value });
        });
        if (specs.length === 0) return alert('è«‹å¡«å¯«åƒ¹æ ¼');

        const main = document.getElementById('mainCat').value;
        const mkType = document.getElementById('makeupType').value;
        let sub = document.getElementById('subCat').value;
        if (sub === 'çœ¼ç·š/è‡¥è ¶') sub = document.getElementById('eyeType').value;

        const product = { 
            id: Date.now(), name, 
            mainCat: main, 
            mkType: main === 'åŒ–å¦å“' ? mkType : '',
            subCat: sub, 
            priority: document.getElementById('priority').value,
            imgUrl: document.getElementById('imgUrl').value,
            prodLink: document.getElementById('prodLink').value,
            specs 
        };

        db.push(product);
        localStorage.setItem('oy_smart_v18', JSON.stringify(db));
        render(); alert('å„²å­˜æˆåŠŸï¼');
    }

    function setFilter(cat, btn) {
        currentFilter = cat;
        document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        render();
    }

    function render() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const containers = { "å¿…è²·": document.getElementById('list-must'), "æƒ³è²·": document.getElementById('list-want'), "æ„Ÿèˆˆè¶£": document.getElementById('list-interest') };
        Object.values(containers).forEach(c => c.innerHTML = '');
        const cartC = document.getElementById('cart-list-container'); cartC.innerHTML = '';
        
        let total = 0, mustT = 0, cartQty = 0;

        db.forEach(p => {
            // æœç´¢èˆ‡ç¯©é¸é‚è¼¯
            const matchesSearch = p.name.toLowerCase().includes(search);
            const matchesFilter = (currentFilter === 'å…¨éƒ¨' || p.mainCat === currentFilter || p.mkType === currentFilter);
            
            if (!matchesSearch || !matchesFilter) return;

            const inCart = cart.includes(p.id);
            const specHtml = p.specs.map(s => `
                <div class="price-display">
                    <span class="price-tag">â‚©${(s.sale || s.orig).toLocaleString()}</span>
                    <span style="font-size:11px; color:#999; margin-left:5px;">(${s.qty})</span>
                </div>`).join('');

            const card = `<div class="item-card ${inCart ? 'in-cart' : ''}">
                ${p.imgUrl ? `<img src="${p.imgUrl}" class="prod-img">` : ''}
                <div class="prod-info">
                    <div style="font-size:10px; color:#888;">${p.mainCat}${p.mkType?':'+p.mkType:''} > ${p.subCat}</div>
                    <div style="font-weight:bold; font-size:15px; margin:2px 0;">${p.name}</div>
                    ${specHtml}
                    <button class="btn-main" style="background:${inCart? '#2ecc71':'#f0f0f0'}; color:${inCart?'white':'#444'}; width:100%; padding:8px; font-size:13px; margin-top:5px;" onclick="toggleCart(${p.id})">${inCart?'âŒ ç§»å‡º':'â• æ”¾å…¥'}</button>
                </div>
            </div>`;
            
            if(containers[p.priority]) containers[p.priority].innerHTML += card;
            if (inCart) { cartC.innerHTML += card; total += (p.specs[0].sale || p.specs[0].orig); cartQty++; if(p.priority==='å¿…è²·') mustT += (p.specs[0].sale || p.specs[0].orig); }
        });

        // çµå¸³åˆ—æ›´æ–°...
        document.getElementById('must-total').innerText = mustT.toLocaleString();
        document.getElementById('total-amount').innerText = total.toLocaleString();
        document.getElementById('cart-count').innerText = cartQty;
        // (çœç•¥é€€ç¨…è¨ˆç®—é‚è¼¯èˆ‡å‰ç‰ˆæœ¬ä¸€è‡´)
    }

    function toggleCart(id) { const idx = cart.indexOf(id); if (idx > -1) cart.splice(idx, 1); else cart.push(id); localStorage.setItem('oy_cart_v18', JSON.stringify(cart)); render(); }
    function switchPage(p, btn) { document.querySelectorAll('.page').forEach(x => x.classList.remove('active')); document.getElementById(p + '-page').classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
    
    updateSubCat(); addSpecInput(); render();
</script>
</body>
</html>