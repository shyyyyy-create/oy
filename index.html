<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OY è³¼ç‰©å°ˆå®¶ - è¡Œå‰é ç®—ç‰ˆ</title>
    <style>
        :root { --primary: #f05a28; --secondary: #97c024; --bg: #f2f2f7; --cart: #2ecc71; --plan: #9b59b6; --tax: #e67e22; --must: #e74c3c; --want: #3498db; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 280px; }
        .card { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; }
        h2 { color: var(--primary); text-align: center; font-size: 18px; margin: 5px 0 15px 0; }
        
        /* å°èˆª */
        .nav-tabs { display: flex; background: white; border-radius: 12px; margin-bottom: 15px; padding: 5px; position: sticky; top: 10px; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nav-btn { flex: 1; padding: 10px 2px; border: none; background: none; font-weight: bold; color: #888; border-radius: 8px; font-size: 12px; }
        .nav-btn.active { background: var(--primary); color: white; }

        /* è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ• */
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box; }
        .btn-main { background: var(--primary); color: white; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-plan { background: var(--plan); color: white; border-radius: 8px; padding: 8px; border: none; flex: 1; font-size: 13px; }
        .btn-cart { background: var(--cart); color: white; border-radius: 8px; padding: 8px; border: none; flex: 1; font-size: 13px; }
        .btn-inactive { background: #eee !important; color: #888 !important; }

        /* ç”¢å“å¡ç‰‡ */
        .item-card { background: white; border-radius: 15px; margin-bottom: 12px; padding: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .item-card.in-plan { border-left: 5px solid var(--plan); }
        .item-card.in-cart { border-left: 5px solid var(--cart); }
        .price-tag { color: var(--must); font-weight: bold; font-size: 16px; }
        .buy-controls { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .row-actions { display: flex; gap: 5px; }
        .qty-box { display: flex; align-items: center; gap: 5px; font-size: 13px; color: #666; }
        .qty-input { width: 50px !important; padding: 5px !important; text-align: center; }

        /* çµå¸³è³‡è¨Š */
        .checkout-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; border-radius: 20px 20px 0 0; }
        .sum-row { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 2px; }
        .total-row { color: var(--primary); font-size: 18px; font-weight: 900; border-top: 1px solid #eee; padding-top: 8px; margin-top: 5px; }

        .page { display: none; }
        .page.active { display: block; }
        .filter-tags { display: flex; gap: 5px; overflow-x: auto; margin-top: 8px; }
        .tag { padding: 5px 10px; background: #fff; border: 1px solid #ddd; border-radius: 15px; font-size: 11px; white-space: nowrap; }
        .tag.active { background: var(--primary); color: white; border-color: var(--primary); }
    </style>
</head>
<body>

<div class="nav-tabs">
    <button class="nav-btn active" onclick="switchPage('wishlist', this)">âœš ç™»è¨˜</button>
    <button class="nav-btn" onclick="switchPage('dashboard', this)">ğŸ“‹ ç¸½è¦½</button>
    <button class="nav-btn" onclick="switchPage('plan', this)">ğŸ“ è¨ˆç•«(<span id="plan-count">0</span>)</button>
    <button class="nav-btn" onclick="switchPage('cart', this)">ğŸ›’ ç±ƒå­(<span id="cart-count">0</span>)</button>
</div>

<div id="wishlist-page" class="page active">
    <div class="card">
        <h2>âœ¨ ç™»è¨˜ç”¢å“è³‡æ–™</h2>
        <div style="display:flex; flex-direction:column; gap:10px;">
            <input type="text" id="name" placeholder="ç”¢å“åç¨± (å¿…å¡«)">
            <div style="display:flex; gap:5px;">
                <select id="mainCat" onchange="updateSubCat()"><option value="è­·è†šå“">ğŸŒ¿ è­·è†š</option><option value="åŒ–å¦å“">ğŸ’„ åŒ–å¦</option><option value="å€‹äººè­·ç†">ğŸš¿ å€‹è­·</option><option value="å…¶ä»–">ğŸ“¦ å…¶ä»–</option></select>
                <div id="makeup-sub" style="display:none; flex:1;"><select id="mkType" onchange="updateSubCat()"><option value="Base">Base</option><option value="Eyes">Eyes</option><option value="Lip">Lip</option></select></div>
            </div>
            <div id="subCatArea"></div>
            <div style="display:flex; gap:5px;">
                <input type="number" id="price" placeholder="åƒ¹æ ¼ â‚©">
                <input type="text" id="spec" placeholder="è¦æ ¼ (å¦‚ 1+1)">
            </div>
            <select id="priority"><option value="å¿…è²·">ğŸ”¥ å¿…è²·</option><option value="æƒ³è²·">ğŸ›ï¸ æƒ³è²·</option><option value="æ„Ÿèˆˆè¶£">âœ¨ æ„Ÿèˆˆè¶£</option></select>
            <button class="btn-main" onclick="saveProduct()">å„²å­˜ç”¢å“</button>
        </div>
    </div>
</div>

<div id="plan-page" class="page">
    <div class="card"><h2>ğŸ“ è¡Œå‰è³¼è²·è¨ˆç•«</h2><div id="plan-list"></div></div>
</div>

<div id="dashboard-page" class="page">
    <div class="card"><input type="text" placeholder="ğŸ” æœç´¢..." id="search" oninput="render()"><div class="filter-tags" id="tags"></div></div>
    <div id="full-list"></div>
</div>

<div id="cart-page" class="page">
    <div class="card"><h2>ğŸ›’ ç¾å ´è³¼ç‰©ç±ƒ</h2><div id="cart-list"></div></div>
</div>

<div class="checkout-bar">
    <div class="sum-row" style="color:var(--plan);"><span>ğŸ“ è¨ˆç•«é ç®—ç¸½è¨ˆ</span><span>â‚©<span id="plan-total">0</span></span></div>
    <div class="sum-row" style="color:var(--cart);"><span>ğŸ›’ ç±ƒå…§å¯¦éš›ç¸½è¨ˆ</span><span>â‚©<span id="cart-total">0</span></span></div>
    <div class="sum-row" style="color:var(--must);"><span>ğŸ”¥ å¿…è²·é …å°è¨ˆ (è¨ˆç•«)</span><span>â‚©<span id="must-total">0</span></span></div>
    <div class="sum-row total-row"><span>é è¨ˆå¯¦ä»˜ (ç±ƒå…§)</span><span>â‚©<span id="final-total">0</span></span></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('oy_db_v20')) || [];
    let plan = JSON.parse(localStorage.getItem('oy_plan_v20')) || []; // [{id, qty}]
    let cart = JSON.parse(localStorage.getItem('oy_cart_v20')) || []; // [{id, qty}]

    function saveProduct() {
        const product = { id: Date.now(), name: document.getElementById('name').value, price: Number(document.getElementById('price').value), priority: document.getElementById('priority').value, subCat: document.getElementById('subCat')?.value || 'å…¶ä»–' };
        db.push(product); localStorage.setItem('oy_db_v20', JSON.stringify(db)); render(); alert('å„²å­˜æˆåŠŸï¼');
    }

    function toggleState(id, listName) {
        let list = listName === 'plan' ? plan : cart;
        let idx = list.findIndex(i => i.id === id);
        if (idx > -1) list.splice(idx, 1);
        else list.push({ id, qty: 1 });
        localStorage.setItem('oy_'+listName+'_v20', JSON.stringify(list));
        render();
    }

    function updateQty(id, val, listName) {
        let list = listName === 'plan' ? plan : cart;
        let item = list.find(i => i.id === id);
        if (item) { item.qty = parseInt(val) || 1; localStorage.setItem('oy_'+listName+'_v20', JSON.stringify(list)); render(); }
    }

    function render() {
        const planCont = document.getElementById('plan-list'); planCont.innerHTML = '';
        const cartCont = document.getElementById('cart-list'); cartCont.innerHTML = '';
        const dashCont = document.getElementById('full-list'); dashCont.innerHTML = '';

        let pTotal = 0, cTotal = 0, mTotal = 0;

        db.forEach(p => {
            const pItem = plan.find(i => i.id === p.id);
            const cItem = cart.find(i => i.id === p.id);

            const cardHtml = `
                <div class="item-card ${pItem?'in-plan':''} ${cItem?'in-cart':''}">
                    <div style="font-size:11px; color:#888;">${p.subCat} | ${p.priority}</div>
                    <div style="font-weight:bold;">${p.name}</div>
                    <div class="price-tag">â‚©${p.price.toLocaleString()}</div>
                    <div class="buy-controls">
                        <div class="row-actions">
                            <button class="btn-plan ${!pItem?'btn-inactive':''}" onclick="toggleState(${p.id}, 'plan')">${pItem?'âœ“ è¨ˆç•«ä¸­':'ï¼‹å…¥è¨ˆç•«'}</button>
                            <button class="btn-cart ${!cItem?'btn-inactive':''}" onclick="toggleState(${p.id}, 'cart')">${cItem?'âœ“ ç±ƒå­è£¡':'ï¼‹å…¥ç±ƒå­'}</button>
                        </div>
                        ${(pItem || cItem) ? `
                        <div class="qty-box">
                            æ•¸é‡: <input type="number" class="qty-input" value="${(cItem||pItem).qty}" onchange="updateQty(${p.id}, this.value, '${cItem?'cart':'plan'}')">
                        </div>` : ''}
                    </div>
                </div>`;

            dashCont.innerHTML += cardHtml;
            if (pItem) { planCont.innerHTML += cardHtml; pTotal += p.price * pItem.qty; if(p.priority==='å¿…è²·') mTotal += p.price * pItem.qty; }
            if (cItem) { cartCont.innerHTML += cardHtml; cTotal += p.price * cItem.qty; }
        });

        document.getElementById('plan-total').innerText = pTotal.toLocaleString();
        document.getElementById('cart-total').innerText = cTotal.toLocaleString();
        document.getElementById('must-total').innerText = mTotal.toLocaleString();
        document.getElementById('plan-count').innerText = plan.length;
        document.getElementById('cart-count').innerText = cart.length;
        document.getElementById('final-total').innerText = (cTotal * 0.95).toLocaleString(); // å‡è¨­ç°¡æ˜“é€€ç¨…
    }

    function switchPage(p, btn) {
        document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
        document.getElementById(p + '-page').classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    render();
</script>
</body>
</html>