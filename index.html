<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OY AI æ‰¹é‡è­˜åˆ¥å°ˆå®¶</title>
    <style>
        :root { --primary: #f05a28; --secondary: #97c024; --bg: #f2f2f7; --cart: #2ecc71; --plan: #9b59b6; --must: #e74c3c; --tax: #3498db; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 280px; color: #333; font-size: 14px; }
        .card { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 12px; }
        .nav-tabs { display: flex; background: white; border-radius: 12px; margin-bottom: 15px; padding: 5px; position: sticky; top: 10px; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nav-btn { flex: 1; padding: 10px 2px; border: none; background: none; font-weight: bold; color: #888; border-radius: 8px; font-size: 11px; }
        .nav-btn.active { background: var(--primary); color: white; }
        
        /* AI ä¸Šå‚³å€æ¨£å¼ */
        .ai-upload-zone { border: 2px dashed #5856d6; background: #f4f4ff; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 15px; }
        .upload-input { display: none; }
        .upload-label { color: #5856d6; font-weight: bold; cursor: pointer; display: block; }
        
        /* è­˜åˆ¥é è¦½ */
        .ai-result-item { background: #fff; border: 1px solid #eee; border-radius: 8px; padding: 10px; margin-top: 10px; font-size: 12px; position: relative; }
        .ai-badge { position: absolute; top: -5px; right: 5px; background: #5856d6; color: white; padding: 2px 6px; border-radius: 10px; font-size: 9px; }

        .item-card { background: white; border-radius: 15px; margin-bottom: 10px; padding: 12px; display: flex; gap: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .prod-img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; }
        .checkout-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; border-radius: 20px 20px 0 0; }
        .page { display: none; }
        .page.active { display: block; }
    </style>
</head>
<body>

<div class="nav-tabs">
    <button class="nav-btn active" onclick="switchPage('wishlist', this)">âœš ç™»è¨˜</button>
    <button class="nav-btn" onclick="switchPage('dashboard', this)">ğŸ“‹ æ¸…å–®</button>
    <button class="nav-btn" onclick="switchPage('plan', this)">ğŸ“ è¨ˆç•«</button>
    <button class="nav-btn" onclick="switchPage('cart', this)">ğŸ›’ ç±ƒå­</button>
</div>

<div id="wishlist-page" class="page active">
    <div class="card">
        <div class="ai-upload-zone">
            <label for="ai-file" class="upload-label">
                <span style="font-size: 24px;">ğŸ“·</span><br>
                é»æ­¤ä¸Šå‚³æˆªåœ– (ä¸Šé™ 5 å¼µ)<br>
                <small style="color: #888; font-weight: normal;">è‡ªå‹•è­˜åˆ¥ç”¢å“åç¨±èˆ‡åƒ¹æ ¼</small>
            </label>
            <input type="file" id="ai-file" class="upload-input" accept="image/*" multiple onchange="handleAIUpload(this)">
        </div>
        
        <div id="ai-results-preview"></div>
        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">
        
        <div id="manual-form">
            <input type="text" id="name" placeholder="ç”¢å“åç¨±">
            <input type="text" id="spec" placeholder="è¦æ ¼ (å¦‚ 1+1)">
            <input type="number" id="priceSale" placeholder="ç‰¹åƒ¹ â‚©">
            <button onclick="saveProduct()" style="width:100%; padding:12px; background:var(--primary); color:white; border:none; border-radius:8px; font-weight:bold;">æ‰‹å‹•å­˜å…¥æ¸…å–®</button>
        </div>
    </div>
</div>

<div id="dashboard-page" class="page"><div id="dash-list"></div></div>
<div id="plan-page" class="page"><div id="plan-list"></div></div>
<div id="cart-page" class="page"><div id="cart-list"></div></div>

<div class="checkout-bar">
    <div style="display:flex; justify-content:space-between; font-size:11px;"><span>ğŸ›’ ç±ƒå­ç¸½è¨ˆ</span><span>â‚©<span id="cart-total">0</span></span></div>
    <div style="display:flex; justify-content:space-between; font-size:12px; margin:4px 0; color:var(--tax);"><span>ğŸ’° é€€ç¨…é¡</span><span>- â‚©<span id="tax-refund">0</span></span></div>
    <div style="font-weight:bold; color:var(--primary); border-top:1px solid #eee; margin-top:5px; padding-top:8px; display:flex; justify-content:space-between; font-size:18px;"><span>é€€ç¨…å¾Œå¯¦ä»˜</span><span>â‚©<span id="final-total">0</span></span></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('oy_db_v300')) || [];
    let cart = JSON.parse(localStorage.getItem('oy_cart_v300')) || [];
    let plan = JSON.parse(localStorage.getItem('oy_plan_v300')) || [];

    function getRefund(amt) {
        if(amt < 15000) return 0; if(amt < 30000) return 1000;
        if(amt < 50000) return 2000; if(amt < 75000) return 3000;
        return Math.floor(amt * 0.06);
    }

    // æ‰¹é‡è™•ç†æˆªåœ–ä¸Šå‚³
    function handleAIUpload(input) {
        const files = Array.from(input.files);
        if (files.length > 5) {
            alert("ä¸€æ¬¡æœ€å¤šåªèƒ½ä¸Šå‚³ 5 å¼µæˆªåœ–å–”ï¼");
            return;
        }

        const previewCont = document.getElementById('ai-results-preview');
        previewCont.innerHTML = '<p style="text-align:center; font-size:12px; color:#5856d6;">ğŸ¤– AI æ­£åœ¨è­˜åˆ¥ä¸­...</p>';

        // æ¨¡æ“¬ç•°æ­¥è­˜åˆ¥éç¨‹
        setTimeout(() => {
            previewCont.innerHTML = '<h3>è­˜åˆ¥çµæœï¼š</h3>';
            files.forEach((file, index) => {
                // æ¨¡æ“¬å¾ä¸åŒæˆªåœ–ä¸­æå–å‡ºçš„ä¸åŒè³‡æ–™
                const mockData = [
                    { name: "Torriden å°å…¥ç²¾è¯", spec: "1+1 ä¼åŠƒ", price: 18900 },
                    { name: "Round Lab ç¨å³¶åŒ–å¦æ°´", spec: "500ml", price: 21000 },
                    { name: "Clio æ°£å¢Šç²‰é¤…", spec: "æœ¬å“+æ›¿æ›è£", price: 32000 },
                    { name: "Anua é­šè…¥è‰é¢è†œ", spec: "10ç‰‡å…¥", price: 15000 },
                    { name: "Bioderma å¸å¦æ°´", spec: "850ml åŠ å¤§ç‰ˆ", price: 24900 }
                ];
                
                const data = mockData[index % mockData.length];
                const div = document.createElement('div');
                div.className = 'ai-result-item';
                div.innerHTML = `
                    <span class="ai-badge">æˆªåœ– ${index+1}</span>
                    <b>${data.name}</b><br>
                    è¦æ ¼: ${data.spec} | åƒ¹æ ¼: â‚©${data.price.toLocaleString()}<br>
                    <button onclick="quickAdd('${data.name}', '${data.spec}', ${data.price})" style="margin-top:5px; font-size:10px; background:var(--secondary); color:white; border:none; border-radius:4px; padding:3px 8px;">ç¢ºèªå­˜å…¥</button>
                `;
                previewCont.appendChild(div);
            });
        }, 1500);
    }

    function quickAdd(name, spec, price) {
        const specData = { specId: Date.now(), name: spec, orig: price, sale: price };
        let p = db.find(x => x.name === name);
        if(p) {
            if(!p.specs.find(s => s.name === spec)) p.specs.push(specData);
        } else {
            db.push({ id: Date.now(), name, img: 'https://via.placeholder.com/100?text=AI', priority: 'æƒ³è²·', specs: [specData] });
        }
        localStorage.setItem('oy_db_v300', JSON.stringify(db));
        render();
        alert(`ã€Œ${name}ã€å·²å­˜å…¥æ¸…å–®ï¼`);
    }

    function addToTarget(prodId, specId, target) {
        let list = (target === 'plan') ? plan : cart;
        // æ ¸å¿ƒé‚è¼¯ï¼šåŒç”¢å“+åŒè¦æ ¼ç´¯åŠ 
        let existing = list.find(x => x.prodId === prodId && x.specId === specId);
        if(existing) {
            existing.qty += 1;
        } else {
            list.push({ prodId, specId, qty: 1 });
        }
        localStorage.setItem('oy_'+target+'_v300', JSON.stringify(list));
        render();
    }

    function render() {
        const dashCont = document.getElementById('dash-list'); dashCont.innerHTML = '';
        const planCont = document.getElementById('plan-list'); planCont.innerHTML = '';
        const cartCont = document.getElementById('cart-list'); cartCont.innerHTML = '';
        let cT = 0;

        db.forEach(p => {
            dashCont.innerHTML += `
                <div class="item-card">
                    <img src="${p.img}" class="prod-img">
                    <div style="flex:1">
                        <b>${p.name}</b>
                        <div style="margin-top:5px;">
                            ${p.specs.map(s => `<button onclick="addToTarget(${p.id}, ${s.specId}, 'cart')" style="font-size:10px; border:1px solid #ddd; border-radius:5px; padding:4px; margin-right:4px;">+ğŸ›’ ${s.name}</button>`).join('')}
                        </div>
                    </div>
                </div>`;
        });

        const drawList = (list, cont, type) => {
            list.forEach((item, idx) => {
                const p = db.find(x => x.id === item.prodId);
                const s = p.specs.find(x => x.specId === item.specId);
                const price = s.sale || s.orig;
                if(type === 'cart') cT += price * item.qty;
                cont.innerHTML += `<div class="item-card"><div><b>${p.name}</b><br><small>${s.name}</small></div><div style="margin-left:auto; text-align:right;">â‚©${price.toLocaleString()}<br><b>x ${item.qty}</b></div></div>`;
            });
        };
        drawList(plan, planCont, 'plan');
        drawList(cart, cartCont, 'cart');

        const refund = getRefund(cT);
        document.getElementById('cart-total').innerText = cT.toLocaleString();
        document.getElementById('tax-refund').innerText = refund.toLocaleString();
        document.getElementById('final-total').innerText = (cT - refund).toLocaleString();
    }

    function switchPage(p, btn) {
        document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
        document.getElementById(p + '-page').classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
    render();
</script>
</body>
</html>