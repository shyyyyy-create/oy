<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Olive Young è³¼ç‰©ç®¡å®¶ Pro</title>
    <style>
        :root { --primary: #f05a28; --secondary: #97c024; --bought: #6c757d; --bg: #f0f2f5; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 80px; }
        .card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; }
        h2 { color: var(--primary); text-align: center; font-size: 20px; margin: 10px 0; }
        
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        input, select { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; background: white; }
        .row { display: flex; gap: 8px; }
        .btn-main { background: var(--primary); color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; margin-top: 5px; cursor: pointer; }
        
        /* ç¯©é¸é¸å–®æ¨£å¼ */
        .filter-tabs { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .tab { flex: 1; padding: 10px; text-align: center; background: white; border-radius: 20px; font-size: 14px; font-weight: bold; color: #666; cursor: pointer; white-space: nowrap; border: 1px solid #eee; }
        .tab.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* ç”¢å“æ¸…å–®æ¨£ style */
        .item-card { background: white; border-radius: 12px; overflow: hidden; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .item-card.is-bought { opacity: 0.7; filter: grayscale(0.5); border-left: 5px solid var(--bought); }
        .prod-img { width: 100%; height: 180px; object-fit: contain; background: #fff; }
        .prod-content { padding: 15px; }
        .prod-title { font-size: 18px; font-weight: bold; color: #222; text-decoration: none; display: block; }
        .category-tag { font-size: 11px; background: #eef2f7; color: #555; padding: 2px 8px; border-radius: 4px; margin: 5px 0; display: inline-block; }
        
        .status-select { margin: 10px 0; width: 100%; border: 1px solid var(--secondary); color: var(--secondary); font-weight: bold; }
        .price-row { display: flex; align-items: baseline; gap: 8px; margin: 5px 0; }
        .price-sale { color: #e74c3c; font-size: 20px; font-weight: 800; }
        .price-orig { color: #aaa; text-decoration: line-through; font-size: 13px; }

        .actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-action { flex: 1; padding: 10px; border-radius: 6px; border: none; font-size: 13px; font-weight: bold; cursor: pointer; }
        .edit { background: #e3f2fd; color: #1976d2; }
        .del { background: #ffebee; color: #c62828; }
    </style>
</head>
<body>

<div class="card">
    <h2 id="form-title">Olive Young è³¼ç‰©ç®¡å®¶ ğŸ›’</h2>
    <div class="form-group">
        <input type="hidden" id="edit-id">
        <input type="text" id="name" placeholder="ç”¢å“åç¨±">
        <input type="text" id="imgUrl" placeholder="åœ–ç‰‡ç¶²å€">
        
        <div class="row">
            <select id="mainCat" onchange="updateSubCat()">
                <option value="è­·è†šå“">è­·è†šå“</option>
                <option value="åŒ–å¦å“">åŒ–å¦å“</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
            <select id="subCat">
                </select>
        </div>

        <select id="status">
            <option value="æ„Ÿèˆˆè¶£">æ„Ÿèˆˆè¶£</option>
            <option value="æƒ³è³¼è²·">æƒ³è³¼è²·</option>
            <option value="è€ƒæ…®è³¼è²·">è€ƒæ…®è³¼è²·</option>
            <option value="å·²è³¼è²·">âœ… å·²è³¼è²·</option>
        </select>

        <input type="text" id="url" placeholder="å®˜ç¶²é€£çµ">
        <div class="row">
            <input type="text" id="origPrice" placeholder="åŸåƒ¹ â‚©">
            <input type="text" id="salePrice" placeholder="ç‰¹åƒ¹ â‚©">
        </div>
        <button class="btn-main" onclick="saveProduct()">å„²å­˜è‡³æ¸…å–®</button>
        <button id="cancel-edit" style="display:none; background:#ccc; margin-top:5px; padding:10px; border-radius:8px; border:none; color:white;" onclick="resetForm()">å–æ¶ˆä¿®æ”¹</button>
    </div>
</div>

<div class="filter-tabs">
    <div class="tab active" onclick="filterList('å…¨éƒ¨', this)">å…¨éƒ¨</div>
    <div class="tab" onclick="filterList('æœªè³¼è²·', this)">æœªè³¼è²·</div>
    <div class="tab" onclick="filterList('å·²è³¼è²·', this)">å·²è³¼è²·</div>
    <div class="tab" onclick="filterList('æƒ³è³¼è²·', this)">å¿…è²·æ¸…å–®</div>
</div>

<div id="list"></div>

<script>
    let db = JSON.parse(localStorage.getItem('oy_final_manager')) || [];
    let currentFilter = 'å…¨éƒ¨';

    const categories = {
        "è­·è†šå“": ["Toner", "Lotion", "Cream", "Mask", "Cleanser", "Serum", "Other"],
        "åŒ–å¦å“": ["Foundation", "Cushion", "Lipstick", "Eye Shadow", "Mascara", "Blush", "Other"],
        "å…¶ä»–": ["Body Care", "Hair Care", "Tools"]
    };

    function updateSubCat() {
        const main = document.getElementById('mainCat').value;
        const sub = document.getElementById('subCat');
        sub.innerHTML = categories[main].map(c => `<option value="${c}">${c}</option>`).join('');
    }

    function saveProduct() {
        const id = document.getElementById('edit-id').value;
        const name = document.getElementById('name').value;
        const imgUrl = document.getElementById('imgUrl').value;
        const mainCat = document.getElementById('mainCat').value;
        const subCat = document.getElementById('subCat').value;
        const status = document.getElementById('status').value;
        const url = document.getElementById('url').value;
        const origPrice = document.getElementById('origPrice').value;
        const salePrice = document.getElementById('salePrice').value;
        const date = new Date().toLocaleDateString();

        if (!name) return alert('è«‹è¼¸å…¥ç”¢å“åç¨±');

        const productData = { id: id || Date.now(), name, imgUrl, mainCat, subCat, status, url, origPrice, salePrice, lastUpdate: date };

        if (id) {
            const idx = db.findIndex(p => p.id == id);
            db[idx] = productData;
        } else {
            db.push(productData);
        }

        localStorage.setItem('oy_final_manager', JSON.stringify(db));
        resetForm();
        render();
    }

    function render() {
        const container = document.getElementById('list');
        container.innerHTML = '';
        
        let filtered = db;
        if (currentFilter === 'æœªè³¼è²·') filtered = db.filter(p => p.status !== 'å·²è³¼è²·');
        if (currentFilter === 'å·²è³¼è²·') filtered = db.filter(p => p.status === 'å·²è³¼è²·');
        if (currentFilter === 'æƒ³è³¼è²·') filtered = db.filter(p => p.status === 'æƒ³è³¼è²·');

        filtered.sort((a,b) => b.id - a.id).forEach(p => {
            const isBought = p.status === 'å·²è³¼è²·';
            container.innerHTML += `
                <div class="item-card ${isBought ? 'is-bought' : ''}">
                    ${p.imgUrl ? `<img src="${p.imgUrl}" class="prod-img">` : ''}
                    <div class="prod-content">
                        <span class="category-tag">${p.mainCat} > ${p.subCat}</span>
                        <a href="${p.url || '#'}" target="_blank" class="prod-title">${p.name}</a>
                        
                        <div class="price-row">
                            <span class="price-sale">â‚©${p.salePrice}</span>
                            <span class="price-orig">â‚©${p.origPrice}</span>
                        </div>

                        <select class="status-select" onchange="quickUpdateStatus(${p.id}, this.value)">
                            <option value="æ„Ÿèˆˆè¶£" ${p.status==='æ„Ÿèˆˆè¶£'?'selected':''}>æ„Ÿèˆˆè¶£</option>
                            <option value="æƒ³è³¼è²·" ${p.status==='æƒ³è³¼è²·'?'selected':''}>æƒ³è³¼è²·</option>
                            <option value="è€ƒæ…®è³¼è²·" ${p.status==='è€ƒæ…®è³¼è²·'?'selected':''}>è€ƒæ…®è³¼è²·</option>
                            <option value="å·²è³¼è²·" ${p.status==='å·²è³¼è²·'?'selected':''}>âœ… å·²è³¼è²·</option>
                        </select>

                        <div class="actions">
                            <button class="btn-action edit" onclick="edit(${p.id})">ç·¨è¼¯</button>
                            <button class="btn-action del" onclick="del(${p.id})">åˆªé™¤</button>
                        </div>
                    </div>
                </div>
            `;
        });
    }

    function quickUpdateStatus(id, newStatus) {
        const idx = db.findIndex(p => p.id == id);
        db[idx].status = newStatus;
        localStorage.setItem('oy_final_manager', JSON.stringify(db));
        render();
    }

    function filterList(type, el) {
        currentFilter = type;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        render();
    }

    function edit(id) {
        const p = db.find(x => x.id == id);
        document.getElementById('edit-id').value = p.id;
        document.getElementById('name').value = p.name;
        document.getElementById('imgUrl').value = p.imgUrl;
        document.getElementById('mainCat').value = p.mainCat;
        updateSubCat();
        document.getElementById('subCat').value = p.subCat;
        document.getElementById('status').value = p.status;
        document.getElementById('url').value = p.url;
        document.getElementById('origPrice').value = p.origPrice;
        document.getElementById('salePrice').value = p.salePrice;
        document.getElementById('form-title').innerText = "ç·¨è¼¯å•†å“ âœï¸";
        document.getElementById('cancel-edit').style.display = "block";
        window.scrollTo(0,0);
    }

    function del(id) { if(confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) { db = db.filter(x => x.id !== id); localStorage.setItem('oy_final_manager', JSON.stringify(db)); render(); } }
    
    function resetForm() { 
        document.getElementById('edit-id').value = '';
        document.querySelectorAll('input').forEach(i => i.value = ''); 
        document.getElementById('form-title').innerText = "Olive Young è³¼ç‰©ç®¡å®¶ ğŸ›’";
        document.getElementById('cancel-edit').style.display = "none";
        updateSubCat();
    }

    // åˆå§‹åŒ–
    updateSubCat();
    render();
</script>

</body>
</html>
