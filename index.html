<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OY è³¼ç‰©å°ˆå®¶ - æ­·å²å­˜æª”ç‰ˆ</title>
    <style>
        :root { --primary: #f05a28; --secondary: #97c024; --bg: #f2f2f7; --cart: #2ecc71; --plan: #9b59b6; --history: #34495e; --tax: #e67e22; --must: #e74c3c; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 280px; color: #333; }
        .card { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; }
        h2 { color: var(--primary); text-align: center; font-size: 18px; margin: 5px 0 10px 0; }
        
        /* å°èˆª */
        .nav-tabs { display: flex; background: white; border-radius: 12px; margin-bottom: 15px; padding: 5px; position: sticky; top: 10px; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nav-btn { flex: 1; padding: 10px 2px; border: none; background: none; font-weight: bold; color: #888; border-radius: 8px; font-size: 11px; }
        .nav-btn.active { background: var(--primary); color: white; }

        /* é€šç”¨æŒ‰éˆ• */
        .btn-main { background: var(--primary); color: white; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-history { background: var(--history); color: white; padding: 8px; border: none; border-radius: 6px; font-size: 12px; }

        /* ç”¢å“å¡ç‰‡ */
        .item-card { background: white; border-radius: 15px; margin-bottom: 10px; padding: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .price-tag { color: var(--must); font-weight: bold; }
        .action-row { display: flex; gap: 5px; margin-top: 8px; }
        .btn-act { flex: 1; padding: 8px; border: none; border-radius: 6px; font-size: 11px; font-weight: bold; }
        .qty-row { display: flex; align-items: center; justify-content: space-between; margin-top: 8px; font-size: 12px; background: #f9f9f9; padding: 5px 8px; border-radius: 6px; }

        /* æ­·å²ç´€éŒ„æ¨£å¼ */
        .history-item { border-left: 5px solid var(--history); margin-bottom: 15px; }
        .history-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px dashed #ddd; padding-bottom: 8px; margin-bottom: 8px; }
        .history-name { font-weight: bold; color: var(--history); }
        .history-detail { font-size: 12px; color: #666; line-height: 1.6; }

        /* çµå¸³åˆ— */
        .checkout-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; border-radius: 20px 20px 0 0; }
        .sum-row { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 3px; }
        .total-row { color: var(--primary); font-size: 18px; font-weight: 900; border-top: 1px solid #eee; padding-top: 8px; }

        .page { display: none; }
        .page.active { display: block; }
    </style>
</head>
<body>

<div class="nav-tabs">
    <button class="nav-btn active" onclick="switchPage('wishlist', this)">âœš ç™»è¨˜</button>
    <button class="nav-btn" onclick="switchPage('dashboard', this)">ğŸ“‹ æ¸…å–®</button>
    <button class="nav-btn" onclick="switchPage('plan', this)">ğŸ“ è¨ˆç•«</button>
    <button class="nav-btn" onclick="switchPage('cart', this)">ğŸ›’ ç±ƒå­</button>
    <button class="nav-btn" onclick="switchPage('history', this)">ğŸ“œ ç´€éŒ„</button>
</div>

<div id="wishlist-page" class="page active">
    <div class="card">
        <h2>âœ¨ ç™»è¨˜ç”¢å“</h2>
        <div style="display:flex; flex-direction:column; gap:10px;">
            <input type="text" id="name" placeholder="ç”¢å“åç¨±">
            <select id="mainCat" onchange="toggleMakeupSub()"><option value="è­·è†šå“">ğŸŒ¿ è­·è†š</option><option value="åŒ–å¦å“">ğŸ’„ åŒ–å¦</option><option value="å€‹äººè­·ç†">ğŸš¿ å€‹è­·</option><option value="å…¶ä»–">ğŸ“¦ å…¶ä»–</option></select>
            <div id="mk-sub" style="display:none;"><select id="mkType"><option value="Base">Base</option><option value="Eyes">Eyes</option><option value="Lip">Lip</option></select></div>
            <div style="display:flex; gap:5px;"><input type="number" id="price" placeholder="â‚© åƒ¹æ ¼"><input type="text" id="spec" placeholder="è¦æ ¼"></div>
            <button class="btn-main" onclick="saveProduct()">å„²å­˜</button>
        </div>
    </div>
</div>

<div id="dashboard-page" class="page"><div id="dash-list" style="padding:5px;"></div></div>

<div id="plan-page" class="page">
    <div class="card">
        <div id="plan-tabs" style="display:flex; gap:5px; overflow-x:auto; margin-bottom:10px;"></div>
        <div id="plan-list"></div>
    </div>
</div>

<div id="cart-page" class="page">
    <div class="card">
        <h2>ğŸ›’ ç•¶å‰è³¼ç‰©ç±ƒ</h2>
        <div id="cart-list"></div>
        <hr>
        <div style="margin-top:15px;">
            <input type="text" id="checkoutName" placeholder="ç‚ºé€™æ¬¡è³¼ç‰©å–å (å¦‚: æ˜æ´æ——è‰¦åº—)">
            <button class="btn-main" style="background:var(--history); margin-top:10px;" onclick="archiveCart()">å®Œæˆçµå¸³ä¸¦å­˜æª”ç´€éŒ„</button>
        </div>
    </div>
</div>

<div id="history-page" class="page">
    <div class="card">
        <h2>ğŸ“œ æ­·å²è³¼è²·ç´€éŒ„</h2>
        <div id="history-list"></div>
    </div>
</div>

<div class="checkout-bar">
    <div class="sum-row"><span>ğŸ“ è¨ˆç•«ç¸½è¨ˆ</span><span>â‚©<span id="plan-total">0</span></span></div>
    <div class="sum-row" style="color:var(--cart);"><span>ğŸ›’ ç±ƒå…§ç¸½è¨ˆ</span><span>â‚©<span id="cart-total">0</span></span></div>
    <div class="sum-row total-row"><span>ç±ƒå…§å¯¦ä»˜ä¼°è¨ˆ</span><span>â‚©<span id="final-total">0</span></span></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('oy_db_v23')) || [];
    let allPlans = JSON.parse(localStorage.getItem('oy_plans_v23')) || { "é è¨­è¨ˆç•«": [] };
    let currentPlan = localStorage.getItem('oy_cur_plan') || "é è¨­è¨ˆç•«";
    let cart = JSON.parse(localStorage.getItem('oy_cart_v23')) || [];
    let history = JSON.parse(localStorage.getItem('oy_history_v23')) || [];

    function saveProduct() {
        const p = { id: Date.now(), name: document.getElementById('name').value, price: Number(document.getElementById('price').value), spec: document.getElementById('spec').value };
        db.push(p); localStorage.setItem('oy_db_v23', JSON.stringify(db)); render();
    }

    // å­˜æª”åŠŸèƒ½
    function archiveCart() {
        if (cart.length === 0) return alert("è³¼ç‰©ç±ƒæ˜¯ç©ºçš„ï¼");
        const name = document.getElementById('checkoutName').value || `è³¼ç‰©ç´€éŒ„ ${new Date().toLocaleString()}`;
        
        const record = {
            id: Date.now(),
            date: new Date().toLocaleString(),
            name: name,
            items: cart.map(item => {
                const product = db.find(p => p.id === item.id);
                return { ...product, qty: item.qty };
            }),
            total: cart.reduce((sum, item) => {
                const product = db.find(p => p.id === item.id);
                return sum + (product.price * item.qty);
            }, 0)
        };

        history.unshift(record);
        localStorage.setItem('oy_history_v23', JSON.stringify(history));
        
        // æ¸…ç©ºè³¼ç‰©ç±ƒ
        cart = [];
        localStorage.setItem('oy_cart_v23', JSON.stringify(cart));
        document.getElementById('checkoutName').value = '';
        
        alert("çµå¸³ç´€éŒ„å·²å­˜æª”ï¼");
        switchPage('history', document.querySelectorAll('.nav-btn')[4]);
        render();
    }

    function deleteHistory(id) {
        if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ")) {
            history = history.filter(h => h.id !== id);
            localStorage.setItem('oy_history_v23', JSON.stringify(history));
            render();
        }
    }

    function renameHistory(id) {
        const newName = prompt("è«‹è¼¸å…¥æ–°çš„ç´€éŒ„åç¨±ï¼š");
        if (newName) {
            const h = history.find(item => item.id === id);
            if (h) h.name = newName;
            localStorage.setItem('oy_history_v23', JSON.stringify(history));
            render();
        }
    }

    function render() {
        const dashCont = document.getElementById('dash-list'); dashCont.innerHTML = '';
        const cartCont = document.getElementById('cart-list'); cartCont.innerHTML = '';
        const histCont = document.getElementById('history-list'); histCont.innerHTML = '';
        let cT = 0;

        // æ¸²æŸ“æ¸…å–® (ç°¡åŒ–ç‰ˆé‚è¼¯)
        db.forEach(p => {
            const inCart = cart.find(i => i.id === p.id);
            const card = `<div class="item-card">
                <b>${p.name}</b> <span class="price-tag">â‚©${p.price.toLocaleString()}</span>
                <div class="action-row">
                    <button class="btn-act" onclick="toggleCart(${p.id})" style="background:${inCart?var(--cart):'#eee'}">${inCart?'âœ“ åœ¨ç±ƒå­':'ï¼‹å…¥ç±ƒå­'}</button>
                </div>
            </div>`;
            dashCont.innerHTML += card;
            if (inCart) {
                cartCont.innerHTML += card;
                cT += p.price * (inCart.qty || 1);
            }
        });

        // æ¸²æŸ“æ­·å²ç´€éŒ„
        history.forEach(h => {
            histCont.innerHTML += `
                <div class="card history-item">
                    <div class="history-header">
                        <div class="history-name">${h.name}</div>
                        <div style="display:flex; gap:5px;">
                            <button onclick="renameHistory(${h.id})" style="font-size:10px; border:none; background:#eee; border-radius:4px; padding:2px 5px;">æ”¹å</button>
                            <button onclick="deleteHistory(${h.id})" style="font-size:10px; border:none; background:#ffe; color:red; border-radius:4px; padding:2px 5px;">åˆªé™¤</button>
                        </div>
                    </div>
                    <div class="history-detail">
                        æ—¥æœŸ: ${h.date}<br>
                        å“é …: ${h.items.map(i => `${i.name} x${i.qty}`).join(', ')}<br>
                        <b style="color:var(--primary)">ç¸½æ¶ˆè²»: â‚©${h.total.toLocaleString()}</b>
                    </div>
                </div>`;
        });

        document.getElementById('cart-total').innerText = cT.toLocaleString();
        document.getElementById('final-total').innerText = (cT * 0.95).toLocaleString();
    }

    // (å…¶é¤˜ toggleCart, updateQty ç­‰å‡½æ•¸ä¿æŒå…ˆå‰é‚è¼¯)
    function toggleCart(id) {
        const idx = cart.findIndex(i => i.id === id);
        if (idx > -1) cart.splice(idx, 1); else cart.push({id, qty:1});
        localStorage.setItem('oy_cart_v23', JSON.stringify(cart)); render();
    }

    function switchPage(p, btn) {
        document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
        document.getElementById(p + '-page').classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function toggleMakeupSub() {
        const main = document.getElementById('mainCat').value;
        document.getElementById('mk-sub').style.display = (main === 'åŒ–å¦å“') ? 'block' : 'none';
    }

    render();
</script>
</body>
</html>